<script>
    // Simple working version - no file loading errors
    const chaptersContainer = document.getElementById('chapters-container');
    const chapterTitle = document.getElementById('chapter-title');
    const chapterText = document.getElementById('chapter-text');
    const prevChapterBtn = document.getElementById('prev-chapter');
    const nextChapterBtn = document.getElementById('next-chapter');
    const readFirstBtn = document.getElementById('read-first-btn');
    const readLastBtn = document.getElementById('read-last-btn');
    const subscribeBtn = document.getElementById('subscribe-btn');
    const commentsContainer = document.getElementById('comments-container');
    const commentText = document.getElementById('comment-text');
    const postCommentBtn = document.getElementById('post-comment-btn');
    const emojiBtns = document.querySelectorAll('.emoji-btn');

    // Sample chapters data - NEWEST FIRST (correct order)
    const chapters = [
        { id: 4, title: "Chapter 4: By a Thread", date: "2023-11-26" },
        { id: 3, title: "Chapter 3: Into the Beast's Layer", date: "2023-11-19" },
        { id: 2, title: "Chapter 2: The Beginning of a Journey", date: "2023-11-12" },
        { id: 1, title: "Chapter 1: The Ironclad Rule", date: "2023-11-05" }
    ];

    let currentChapterIndex = 0; // Start with latest chapter (index 0)
    let comments = JSON.parse(localStorage.getItem('ashesComments')) || {1: []};

    // Emoji picker
    emojiBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            commentText.value += btn.textContent;
            commentText.focus();
        });
    });

    // Post comment
    postCommentBtn.addEventListener('click', () => {
        const text = commentText.value.trim();
        if (!text) return;

        const chapterId = chapters[currentChapterIndex].id;
        const comment = {
            id: Date.now(),
            author: 'Reader',
            content: text,
            date: new Date().toISOString(),
            likes: 0,
            replies: []
        };

        if (!comments[chapterId]) {
            comments[chapterId] = [];
        }

        comments[chapterId].unshift(comment);
        localStorage.setItem('ashesComments', JSON.stringify(comments));
        renderComments(chapterId);
        commentText.value = '';
    });

    function renderComments(chapterId) {
        commentsContainer.innerHTML = '';
        
        if (!comments[chapterId] || comments[chapterId].length === 0) {
            commentsContainer.innerHTML = '<p>No comments yet. Be the first to share your thoughts!</p>';
            return;
        }

        comments[chapterId].forEach(comment => {
            const commentEl = document.createElement('div');
            commentEl.className = 'comment';
            commentEl.innerHTML = `
                <div class="comment-header">
                    <span class="comment-author">${comment.author}</span>
                    <span class="comment-date">${formatDate(comment.date)}</span>
                </div>
                <div class="comment-content">${comment.content}</div>
                <div class="comment-actions">
                    <button class="like-btn">üëç ${comment.likes || 0}</button>
                    <button class="reply-btn">Reply</button>
                </div>
            `;
            commentsContainer.appendChild(commentEl);
        });
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;
        
        if (diff < 60000) return 'Just now';
        if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
        if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
        
        const options = { year: 'numeric', month: 'short', day: 'numeric' };
        return date.toLocaleDateString(undefined, options);
    }

    // FIXED NAVIGATION LOGIC
    function updateNavigation() {
        // "Previous" goes to NEWER chapters (lower index)
        prevChapterBtn.disabled = currentChapterIndex === 0;
        // "Next" goes to OLDER chapters (higher index)  
        nextChapterBtn.disabled = currentChapterIndex === chapters.length - 1;
    }

    function loadChapter(index) {
        currentChapterIndex = index;
        const chapter = chapters[index];
        
        chapterTitle.textContent = chapter.title;
        chapterText.innerHTML = `<p>Loading ${chapter.title}...</p><p>This would show the actual chapter content when chapter files are added.</p>`;
        
        updateNavigation();
        renderComments(chapter.id);
        
        // Update chapter list highlighting
        document.querySelectorAll('.chapter-item').forEach((item, i) => {
            item.classList.toggle('latest', i === index);
        });
    }

    // Navigation buttons - FIXED
    prevChapterBtn.addEventListener('click', () => {
        if (currentChapterIndex > 0) {
            loadChapter(currentChapterIndex - 1); // Go to NEWER chapter
        }
    });

    nextChapterBtn.addEventListener('click', () => {
        if (currentChapterIndex < chapters.length - 1) {
            loadChapter(currentChapterIndex + 1); // Go to OLDER chapter
        }
    });

    readFirstBtn.addEventListener('click', () => {
        loadChapter(chapters.length - 1); // Last item = Chapter 1
    });

    readLastBtn.addEventListener('click', () => {
        loadChapter(0); // First item = Latest chapter
    });

    subscribeBtn.addEventListener('click', () => {
        const email = prompt('Enter your email to subscribe for chapter updates:');
        if (email) {
            alert(`Thank you for subscribing! You'll be notified when new chapters are published.`);
        }
    });

    // Initialize chapter list
    function initChapters() {
        chaptersContainer.innerHTML = '';
        chapters.forEach((chapter, index) => {
            const div = document.createElement('div');
            div.className = `chapter-item ${index === currentChapterIndex ? 'latest' : ''}`;
            div.innerHTML = `
                <div class="chapter-title">${chapter.title}</div>
                <div class="chapter-date">${formatDate(chapter.date)}</div>
            `;
            div.addEventListener('click', () => loadChapter(index));
            chaptersContainer.appendChild(div);
        });
    }

    // Load initial state
    initChapters();
    loadChapter(0); // Start with latest chapter
    updateNavigation();
</script>
