<script>
    const chaptersContainer = document.getElementById('chapters-container');
    const chapterTitle = document.getElementById('chapter-title');
    const chapterText = document.getElementById('chapter-text');
    const prevChapterBtn = document.getElementById('prev-chapter');
    const nextChapterBtn = document.getElementById('next-chapter');

    let chapters = [];
    let currentChapterIndex = 0;

    async function init() {
        try {
            const response = await fetch('chapters.json');
            const data = await response.json();
            chapters = data.chapters;
            renderChapters();
            if (chapters.length > 0) {
                loadChapter(0);
            }
        } catch (error) {
            chaptersContainer.innerHTML = '<p>Error loading chapters.</p>';
        }
    }

    function renderChapters() {
        chaptersContainer.innerHTML = '';
        chapters.forEach((chapter, index) => {
            const div = document.createElement('div');
            div.className = `chapter-item ${index === currentChapterIndex ? 'latest' : ''}`;
            div.innerHTML = `<div class="chapter-title">${chapter.title}</div>`;
            div.onclick = () => loadChapter(index);
            chaptersContainer.appendChild(div);
        });
    }

    async function loadChapter(index) {
        const chapter = chapters[index];
        chapterTitle.textContent = chapter.title;
        chapterText.innerHTML = '<p>Loading...</p>';
        
        try {
            const response = await fetch(chapter.file);
            const content = await response.text();
            chapterText.innerHTML = content;
            currentChapterIndex = index;
            updateNavigation();
            renderChapters(); // Re-render to update highlighting
        } catch (error) {
            chapterText.innerHTML = '<p>Error loading chapter.</p>';
        }
    }

    function updateNavigation() {
        // FIXED: Previous button should go to lower index (earlier chapter)
        prevChapterBtn.disabled = currentChapterIndex === chapters.length - 1;
        // FIXED: Next button should go to higher index (later chapter)
        nextChapterBtn.disabled = currentChapterIndex === 0;
    }

    // FIXED: Navigation button logic
    prevChapterBtn.onclick = () => {
        if (currentChapterIndex < chapters.length - 1) {
            loadChapter(currentChapterIndex + 1);
        }
    };

    nextChapterBtn.onclick = () => {
        if (currentChapterIndex > 0) {
            loadChapter(currentChapterIndex - 1);
        }
    };

    init();
</script>
